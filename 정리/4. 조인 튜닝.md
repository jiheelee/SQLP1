## 4. 조인 튜닝

19. 소트 머지 조인의 특징

소트 머지 조인은 조인을 위해 실시간으로 인덱스를 생성하는 것과 다름없다. 양쪽 집합을 정렬한 다음에는 NL조인과같은 방식으로 진행하지만, PGA 영역에 저장한 데이터를 이용하기 때문에 빠르다고 앞선 문제에서 설명했다. 따라서 소트 부하만 감소한다면, 건건이 버퍼캐시를 경유하는 NL 조인보다 빠르다.

NL조인은 조인 컬럼에 대한 인덱스 유무에 크게 영향을 받지만, 소트 머지 조인은 영향을 받지 않는다. 양쪽 집합을 개별적으로 읽고 나서 조인을 시작한다는 특징도 있다. <u>따라서 조인 컬럼에 인덱스가 없는 상황에서 두 테이블을 각각 읽어 조인 대상 집합을 줄일 수 있을 떄 아주 유리하다.??</u>					

*>= 조건이 조인 조건이라서 HASH 는 못 쓰지만, 대량 데이터 조회라 소트머지를 써야하는 상황에서, 조인 컬럼에 인덱스가 있으면 좋을 것.

하지만 인덱스가 없을 때, NL vs MERGE JOIN  고르라면 MERGE가 훨씬 유리함.

추가적으로, 만약 인덱스에 없는 컬럼도 SELECT 해야한다면? 인덱스가 무슨 소용일까 싶음. 어차피 테이블은 인덱스 순서랑 다르니까 조인 컬럼으로 다시 조회해야할텐데...?!



스캔 위주의 액세스 방식을 사용한다는 점도 중요한 특징이다. 하지만 모든 처리가 스캔 방식으로 이루어지진 않는다. 양쪽 소스 집합으로부터 조인 대상 레코드를 찾을 때 인덱스를 이용한다면 랜덤 액세스가 일어난다. 이는 해시 조인도 마찬가지다.

소트 머지 조인도 조인 프로세싱 자체는 NL조인과 같다. 그런데도 대량 데이터를 조인할 때 소트 머지 조인이 빠른 이유는 첫 번쨰 집합을 기준으로 두 번째 집합을 반복 액세스 할때는 버퍼캐시를 탐색하지 않고 PGA에서 데이터를 읽기 때문이다. 따라서 두번쨰 집합은 반드시 정렬해서 PGA에 저장한 후에 조인을 시작한다.																																																																																																							

26. SORT MERGE JOIN 대신 HASH JOIN 을 사용하는 이유!!!?

- SORT 를 하는 부하가 있음

- SORT MERGE JOIN은 한쪽이라도 너무 크게 되면 TEMP TABLE SPACE로 넘어가면서 엄청 느려지지만,

  HASH JOIN 은 한개만 현저히 작으면 됨!



27. 2번은 조금 이해를 할 수 없다.

현재) unique scan 으로 90000번 중, 그리고 현재는 인덱스도 잘 못 타고 있어서 좋아보이진 않음.

바꾸면) 1000번 조인인데, 1000번을 인덱스 타야함.

뭐가 좋은지 잘 모르겠음!!!

하긴 엄청 큰 테이블은 수직 scan 한다는게 크긴 할 거 같음...

28. = 조건인 것만 해시값으로 구성할 수 있다.

31. 소트머지조인도 조인 순서의 영향을 받지만 hash 나 nl 보다는 크지 않음

